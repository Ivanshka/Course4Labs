Методичка:
24. ЛР odoo-module.docx

Задание: создать свой тестовый модуль для Odoo внутри контейнера, переместить его на ВМ, затем на хост,
потом настроить в PyCharm и переместить обратно в ВМ и в контейнер Odoo

Сдача лабы:
1 страница Firefox: показываем, что у Anita Oliver есть IBAN
2 страница Firefox: показываем, что у Anita Oliver 2 контракта каждый по 4500
3 страница Firefox: показываем, что у в отчете в Anita Oliver есть ее IBAN и прописана сумма контрактов в 9000

--------------------------------------------------------------------------------------------------------------

Делаем лабу:

0) Аккуратно следуем методичке:
	Узнаем путь монтирования папки доп. модулей Odoo внутри контейнера
		Вводим команду
			docker inspect odoo | less
		
		И ищем раздел "Mounts", в нем - строки
			"Source": "/var/lib/docker/volumes/*длиннющий_путь*/_data",
			"Destination": "/mnt/extra-addons",
		
		Это значит, что папка хоста, лежащая по пути "Source" монтируется как /mnt/extra-addons внутри контейнера.
		Запоминаем этот момент.
		
	Запускаем bash внутри контейнера и создаем заготовку тестового модуля
		docker exec -it odoo /bin/bash
		odoo scaffold test_module /mnt/extra-addons/
	
	Теперь у нас есть тестовый модуль в папке /mnt/extra-addons/test_module контейнера
	
	Выходим из внутриконтейнерного bash
		exit
	
	Качаем исходники Odoo на хост (~150 МБ):
		git clone https://github.com/odoo/odoo
	
	Пока качается, перемещаем модуль на хост. Тут есть 2 варианта (проще 1):
		Вариант 1:
			Т.к. мы знаем, что /mnt/extra-addons/ в контейнере - это наш "Source" на виртуалке, то просто
			скопируем оттуда наши файлы. Просто так в "Source" нас не пустит - нет прав. Так что сначала
			получим их командой
				sudo chmod ugo+rwx /var/lib/docker/
				
			Теперь копируем на хост любым удбным способом
			
		Вариант 2:
			Т.к. контейнер полностью изолирован от ВМ, копируем модуль из контейнера сначала на ВМ командой
				ИЗ контейнера:
					sudo docker cp *ID/name контейнера*:*что копируем* *куда копируем*
						пример:
					sudo docker cp odoo:/mnt/extra-addons/test_module ~/test_module
				В контейнер:
					sudo docker cp *куда копируем* *ID/name контейнера*:*что копируем*
						пример:
					sudo docker cp ~/test_module odoo:/mnt/extra-addons/test_module
					
			А затем копируем на хост через FTP, флешку или как душе угодно.
			
	Скопированный test_module копируем в
		*корень исходников*/addons
	Методичка нас предупреждает, чтобы мы случайно не скопировали в
		*корень исходников*/odoo/addons
	Так что будем внимательными
	
	Теперь открываем *корень исходников* в PyCharm, по папкам добираемся до test_module и пишем все то, что
	сказано написать в методичке.
	
	Написали? Теперь забрасываем test_module в виртуалку, затем обратно в Source любым из 2 способов
	
	Перезапускаем контейнер командами
		docker stop odoo
		docker start odoo
	
	Под главным пользователем идем в настройки Odoo и включаем режим разраба
	
	Идем в "Приложения", удаляем все фильтры из поля поиска, вбиваем туда test_module и устанавливаем наш модуль
	
	Модуль при установке также подтянет приложение "Сотрудники" (Employees) как зависимость.
	
1) Добавляем договоры и скачиваем отчет:
	При попытке добавить новый договор (Contracts) любому взятому сотруднику в Odoo версии 15.0 (ниже - хз)
	ты будешь негодующе искать кнопку "Договоры", ведь она будет везде (лк и гугл), но только не в твоем интерфейсе.
	
	При попытке нажать на "Get salary list for Belarusbank" ты будешь растеряно наблюдать 500-ю ошибку сервера
	
	Снова идем в "Приложения"
	
	Ставим приложение "Контракты Сотрудников" (в поиске можно вбить код hr_contract).
	
	Идем в "Сотрудники", выбираем любого чела, видим новую кнопочку в верхней строке, отвечающую за договоры
	
	Добавляем пару договоров
	
	Жмем на "Get salary list for Belarusbank" и спокойно скачиваем отчет
	
	PROFIT
	